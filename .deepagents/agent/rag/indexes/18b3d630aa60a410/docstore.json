{"docstore/metadata": {"b33f77a4-f79f-4b39-8e3f-3d64028772b8": {"doc_hash": "421d03d18c36dc09c7dd113680587fd4dc10e90defac8512432282294259e68c"}, "1ca58fd8-27f5-48c6-885b-ff9718b6d2a5": {"doc_hash": "ae0e14bef07f468bb62d4bb5690d1c74dce1f5195b6f925f46c288b656537b73", "ref_doc_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8"}, "3c93d012-92c2-4ec5-8678-3c3a15607f87": {"doc_hash": "754c41590851a1076ec0aae5874679c4b65588c49de67b09d2130aa336fa54f3", "ref_doc_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8"}, "6df69ace-7674-49a1-9c41-ea5e69cd3e96": {"doc_hash": "a1e6fd6ebfe9c08109de56030fac053d4d709b2e8650e8da10c04b69c2c02f82", "ref_doc_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8"}, "c240647c-48d3-438d-b051-2f9a1866fd57": {"doc_hash": "7633eca01e5366a5cfa0b969be3d6b82fc08cbc6420b04bde440c153e9908d76", "ref_doc_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8"}, "af9fa3d5-3b1d-40fe-bc97-d9010e127143": {"doc_hash": "161a056ebb20aa145ba69d8cd617e9c406bd4687f1a8bf2fd4a984f7f244e8b8", "ref_doc_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8"}, "cdcba056-4926-4f36-8bdb-7385cb1f1986": {"doc_hash": "60e6786e3103f063aee827c832c30385dbfb51eff98c2a57e17ee2e46ac7cbc9", "ref_doc_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8"}, "942f6446-5230-4275-81c0-6ffbda882463": {"doc_hash": "74a5c445b059edbd1ee662fbdb8adf36ef248b4df4242190991bf73470545d00", "ref_doc_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8"}}, "docstore/ref_doc_info": {"b33f77a4-f79f-4b39-8e3f-3d64028772b8": {"node_ids": ["1ca58fd8-27f5-48c6-885b-ff9718b6d2a5", "3c93d012-92c2-4ec5-8678-3c3a15607f87", "6df69ace-7674-49a1-9c41-ea5e69cd3e96", "c240647c-48d3-438d-b051-2f9a1866fd57", "af9fa3d5-3b1d-40fe-bc97-d9010e127143", "cdcba056-4926-4f36-8bdb-7385cb1f1986", "942f6446-5230-4275-81c0-6ffbda882463"], "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}}}, "docstore/data": {"1ca58fd8-27f5-48c6-885b-ff9718b6d2a5": {"__data__": {"id_": "1ca58fd8-27f5-48c6-885b-ff9718b6d2a5", "embedding": null, "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8", "node_type": "4", "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "hash": "421d03d18c36dc09c7dd113680587fd4dc10e90defac8512432282294259e68c", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "3c93d012-92c2-4ec5-8678-3c3a15607f87", "node_type": "1", "metadata": {}, "hash": "a7dfc86ba0ade94ae81e90c789590ca595f01fddedf114a27846b4c32a62180c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# AIPPT \u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u5b58\u50a8\u6d41\u7a0b\u8bf4\u660e\r\n\r\n## 1. \u6a21\u5757\u6982\u89c8\r\n\r\n- **\u63a5\u53e3\u6587\u4ef6**\uff1a`app/api/aippt_api.py`\r\n- **\u6838\u5fc3\u670d\u52a1**\uff1a`app/services/agents/aippt_service.py`\r\n- **\u4f1a\u8bdd\u670d\u52a1**\uff1a`app/services/agents/session_service.py`\r\n- **\u6d88\u606f\u670d\u52a1**\uff1a`app/services/agents/message_service.py`\r\n- **\u5e38\u91cf\u5b9a\u4e49**\uff1a`app/common/constants.py`\r\n\r\nAIPPT \u6a21\u5757\u63d0\u4f9b\u4e86\u4e00\u7ec4\u4ee5 `/aippt` \u4e3a\u524d\u7f00\u7684 FastAPI \u63a5\u53e3\uff0c\u7528\u4e8e\uff1a\r\n\r\n- \u751f\u6210 PPT \u4e3b\u9898\u4e0e\u5927\u7eb2\r\n- \u751f\u6210\u5c01\u9762\u6a21\u677f\u5e76\u652f\u6301\u4e8c\u6b21\u8c03\u6574\r\n- \u57fa\u4e8e\u9009\u4e2d\u5c01\u9762\u4e0e\u5927\u7eb2\u751f\u6210\u5b8c\u6574 PPT\r\n- \u8f6e\u8be2\u751f\u6210\u7ed3\u679c\u3001\u83b7\u53d6\u4e0b\u8f7d\u94fe\u63a5\u4e0e\u5728\u7ebf\u7f16\u8f91\u94fe\u63a5\r\n\r\n\u6574\u4e2a\u94fe\u8def\u4f1a\u5c06\u4f1a\u8bdd\u4e0e\u6d88\u606f\u843d\u5e93\u5230 MongoDB\uff0c\u4ee5\u652f\u6301\u524d\u7aef\u4f1a\u8bdd\u5217\u8868\u4e0e\u5386\u53f2\u8bb0\u5f55\u5c55\u793a\u3002\r\n\r\n---\r\n\r\n## 2. \u63a5\u53e3\u5c42\uff1a`aippt_api.py`\r\n\r\n### 2.1 \u8bf7\u6c42\u6a21\u578b\r\n\r\n- **`AipptParams`**\r\n  - `user_id`: \u7528\u6237 ID\uff0c\u5fc5\u586b\r\n  - `agent_id`: \u667a\u80fd\u4f53 ID\uff0c\u5fc5\u586b\r\n  - `session_id`: \u4f1a\u8bdd ID\uff0c\u9ed8\u8ba4 `\"0\"` \u8868\u793a\u65b0\u4f1a\u8bdd\r\n  - `skill_id`: \u6280\u80fd ID\uff0c\u9ed8\u8ba4 `\"-1\"`\r\n  - `question`: `Dict[str, Any]`\uff0cAIPPT \u5404\u9636\u6bb5\u7684\u4e1a\u52a1\u53c2\u6570\r\n  - `plugin_json`: \u6269\u5c55\u80fd\u529b\u5f00\u5173\uff0c\u76ee\u524d\u4ec5\u5360\u4f4d\uff08\u5982 deep_think\u3001web_search\uff09\r\n\r\n\u6240\u6709\u63a5\u53e3\u9996\u5148\u5c06 Pydantic \u6a21\u578b `AipptParams` \u8f6c\u6210\u5b57\u5178\uff0c\u7136\u540e\u8c03\u7528 `get_validated_aippt_params(params)`\uff1a\r\n\r\n- \u901a\u8fc7 `AgentService.get_agent_by_id(agent_id)` \u4ece `user_agent` \u96c6\u5408\u4e2d\u8bfb\u53d6\u667a\u80fd\u4f53\u914d\u7f6e\r\n- \u68c0\u67e5\u667a\u80fd\u4f53\u662f\u5426\u5b58\u5728\u4e14 `publish_state == 1`\r\n- \u5c06 `tenant_id` \u6ce8\u5165\u5230 `params` \u4e2d\r\n\r\n### 2.2 \u4e3b\u8981\u8def\u7531\r\n\r\n- **POST `/aippt/chat`** \u2192 `AipptService.get_aippt_chat`\r\n- **POST `/aippt/update/catalogs`** \u2192 `AipptService.get_aippt_update_catalogs`\r\n- **POST `/aippt/cover`** \u2192 `AipptService.get_aippt_cover`\r\n- **POST `/aippt/cover/update`** \u2192 `AipptService.get_aippt_cover_update`\r\n- **POST `/aippt/create`** \u2192 `AipptService.get_aippt_create`\r\n- **POST `/aippt/result`** \u2192 `AipptService.get_aippt_result`\r\n- **POST `/aippt/download`** \u2192 `AipptService.get_aippt_download`\r\n- **POST `/aippt/editor`** \u2192 `AipptService.get_aippt_editor`\r\n\r\n\u63a5\u53e3\u5c42\u53ea\u8d1f\u8d23\uff1a\r\n\r\n- \u53c2\u6570\u6821\u9a8c\uff08\u4ea4\u7ed9 Pydantic\uff09\r\n- \u667a\u80fd\u4f53\u6821\u9a8c + \u6ce8\u5165 `tenant_id`\r\n- \u8c03\u7528\u5bf9\u5e94 Service\r\n- \u5305\u88c5\u7edf\u4e00\u8fd4\u56de\u7ed3\u6784 `Result.data(...)` / `Result.false(...)`\r\n\r\n---\r\n\r\n## 3.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1658, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "3c93d012-92c2-4ec5-8678-3c3a15607f87": {"__data__": {"id_": "3c93d012-92c2-4ec5-8678-3c3a15607f87", "embedding": null, "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8", "node_type": "4", "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "hash": "421d03d18c36dc09c7dd113680587fd4dc10e90defac8512432282294259e68c", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "1ca58fd8-27f5-48c6-885b-ff9718b6d2a5", "node_type": "1", "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "hash": "ae0e14bef07f468bb62d4bb5690d1c74dce1f5195b6f925f46c288b656537b73", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "6df69ace-7674-49a1-9c41-ea5e69cd3e96", "node_type": "1", "metadata": {}, "hash": "92cbdaaace3339af33f4ded8f9cccea21bf2fdb6989781db5ff5143d26ad4b5c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\u4e1a\u52a1\u670d\u52a1\u5c42\uff1a`aippt_service.py`\r\n\r\n### 3.1 \u914d\u7f6e\u4e0e\u5916\u90e8\u4f9d\u8d56\r\n\r\n- \u4f7f\u7528 `ConfigLoader` \u8bfb\u53d6\u914d\u7f6e\uff1a\r\n  - `aippt.structure_url`\uff1a\u751f\u6210\u5927\u7eb2\r\n  - `aippt.cover_url`\uff1a\u751f\u6210\u5c01\u9762\r\n  - `aippt.create_url`\uff1a\u751f\u6210 PPT\r\n  - `aippt.result_url`\uff1a\u67e5\u8be2\u751f\u6210\u7ed3\u679c\r\n  - `aippt.download_url`\uff1a\u83b7\u53d6\u4e0b\u8f7d\u94fe\u63a5\r\n  - `aippt.editor_url`\uff1a\u83b7\u53d6\u5728\u7ebf\u7f16\u8f91\u94fe\u63a5\r\n  - `aippt.key`\uff1a\u8bbf\u95ee\u7b2c\u4e09\u65b9 AIPPT \u5e73\u53f0\u7684 API Key\r\n- \u4f7f\u7528 `dashscope` \u8c03\u7528\u963f\u91cc\u4e91\u901a\u4e49\u6a21\u578b\uff08\u4f8b\u5982 `qwen-plus`\uff09\r\n- \u4f7f\u7528 `httpx.AsyncClient` \u8c03\u7528\u7b2c\u4e09\u65b9 AIPPT HTTP \u63a5\u53e3\uff08POST / GET\uff09\r\n\r\n### 3.2 \u4f1a\u8bdd\u4e0e\u6d88\u606f\u76f8\u5173\u5e38\u91cf\r\n\r\n\u6765\u81ea `constants.py`\uff1a\r\n\r\n- `HandlerCode.AIPPT`\uff1a\u6807\u8bc6\u5f53\u524d handler \u4e3a AIPPT \u4e1a\u52a1\r\n- `AgentContentType.AIPPT_THEME`\uff1a\u4e3b\u9898 / \u4e3b\u9898\u95ee\u9898\r\n- `AgentContentType.AIPPT_CATALOG`\uff1a\u5927\u7eb2\u7ed3\u679c\r\n- `AgentContentType.AIPPT_COVER`\uff1a\u5c01\u9762\u7ed3\u679c\r\n- `AgentContentType.AIPPT_RESULT`\uff1a\u6700\u7ec8 PPT \u751f\u6210\u7ed3\u679c\r\n\r\n\u8fd9\u4e9b\u5b57\u6bb5\u4f1a\u5199\u5165 MongoDB \u6d88\u606f\u6587\u6863\uff0c\u7528\u4e8e\u524d\u7aef\u533a\u5206\u4e0d\u540c\u5185\u5bb9\u7c7b\u578b\u3002\r\n\r\n---\r\n\r\n## 4. \u6838\u5fc3\u94fe\u8def\u62c6\u89e3\r\n\r\n### 4.1 `/aippt/chat`\uff1a\u4ece\u4e00\u53e5\u8bdd\u5230\u5927\u7eb2\r\n\r\n1. **\u8bf7\u6c42\u8fdb\u5165 `aippt_chat`**\r\n   - \u53cd\u5e8f\u5217\u5316\u5f97\u5230 `params: AipptParams`\r\n   - \u8c03\u7528 `get_validated_aippt_params` \u6821\u9a8c\u667a\u80fd\u4f53\r\n\r\n2. **\u66f4\u65b0\u5386\u53f2\u8bb0\u5f55\u72b6\u6001**\r\n   - \u8c03\u7528 `update_ongoing_status_by_session_id(params)`\uff1a\r\n     - \u82e5 `session_id != \"0\"`\uff0c\u5219\u901a\u8fc7 `get_aippt_messages` \u67e5\u8be2\u8be5\u4f1a\u8bdd\u4e0b\u5386\u53f2 AIPPT \u6d88\u606f\r\n     - \u627e\u5230 `content_type in [\"aippt_cover\", \"aippt_catalog\"]` \u7684\u6d88\u606f\r\n     - \u5c06\u5176 `content.ongoing_status` \u6539\u4e3a `\"3\"`\uff08\u5df2\u4fee\u6539/\u5df2\u7ed3\u675f\uff09\u5e76\u843d\u5e93\r\n\r\n3. **\u6784\u9020 LLM \u63d0\u793a\u8bcd**\r\n   - \u4ece `params[\"question\"][\"theme\"]` \u53d6\u7528\u6237\u4e00\u53e5\u8bdd\u9700\u6c42\r\n   - \u5c06\u5176\u586b\u5165 `aippt_template`\uff0c\u751f\u6210\u4e00\u6761 prompt\r\n\r\n4. **\u4f1a\u8bdd\u4e0e\u95ee\u9898\u5165\u5e93**\r\n   - \u8bbe\u7f6e `params[\"handler\"] = HandlerCode.AIPPT`\r\n   - \u6784\u9020 `params_session`\uff0c\u5c06 `question` \u7b80\u5316\u4e3a\u4e3b\u9898\u5b57\u7b26\u4e32\uff1a\r\n     - `params_session[\"question\"] = params[\"question\"][\"theme\"]`\r\n   - \u8c03\u7528 `SessionService.upsert_agent_session(params_session)`\uff1a\r\n     - \u82e5 `session_id` \u4e3a\u7a7a\u6216\u4e3a `\"0\"`\uff0c\u521b\u5efa\u65b0\u4f1a\u8bdd\u8bb0\u5f55\r\n     - \u5426\u5219\u67e5\u8be2\u662f\u5426\u5b58\u5728\u8be5\u4f1a\u8bdd\uff0c\u5b58\u5728\u5219\u66f4\u65b0 `skill_id` / `handler_json`\uff0c\u4e0d\u5b58\u5728\u5219\u65b0\u5efa\r\n   - \u62ff\u5230 `session_id` \u540e\uff0c\u8c03\u7528 `save_message_question(session_id, params)`\uff1a\r\n     - `content_type = AIPPT_THEME`\r\n     - `question.ongoing_status = \"1\"`\uff08\u8fdb\u884c\u4e2d\uff09\r\n     - \u901a\u8fc7 `MessageService.aippt_save_messages(\"user\", message_question)` \u5199\u5165 `ai_agent_message` \u96c6\u5408\r\n\r\n5. **\u201c\u9884\u7559\u7b54\u6848\u201d\u5165\u5e93**\r\n   - \u5c06 `params` \u62f7\u8d1d\u5230 `message_answer`\uff0c\u5e76\u8bbe\u7f6e\uff1a\r\n     - `reply_id = question_id`\r\n     - `content_type = AIPPT_CATALOG`\r\n     - `content.ongoing_status = \"0\"`\uff08\u672a\u5b8c\u6210\uff09\r\n   - \u901a\u8fc7 `save_message_answer(session_id, message_answer, AgentContentType.AIPPT_CATALOG, \"0\")` \u5199\u5165\u4e00\u6761 assistant \u6d88\u606f\u4f5c\u4e3a\u201c\u7a7a\u7b54\u6848\u5360\u4f4d\u201d\uff0c\u7b49\u5f85\u540e\u7eed\u66f4\u65b0\r\n\r\n6.", "mimetype": "text/plain", "start_char_idx": 1659, "end_char_idx": 3822, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "6df69ace-7674-49a1-9c41-ea5e69cd3e96": {"__data__": {"id_": "6df69ace-7674-49a1-9c41-ea5e69cd3e96", "embedding": null, "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8", "node_type": "4", "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "hash": "421d03d18c36dc09c7dd113680587fd4dc10e90defac8512432282294259e68c", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "3c93d012-92c2-4ec5-8678-3c3a15607f87", "node_type": "1", "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "hash": "754c41590851a1076ec0aae5874679c4b65588c49de67b09d2130aa336fa54f3", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "c240647c-48d3-438d-b051-2f9a1866fd57", "node_type": "1", "metadata": {}, "hash": "51252eaad95b6ddef1269720bc53414b482f94afea3dd82ff09731e56355c91b", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "**\u201c\u9884\u7559\u7b54\u6848\u201d\u5165\u5e93**\r\n   - \u5c06 `params` \u62f7\u8d1d\u5230 `message_answer`\uff0c\u5e76\u8bbe\u7f6e\uff1a\r\n     - `reply_id = question_id`\r\n     - `content_type = AIPPT_CATALOG`\r\n     - `content.ongoing_status = \"0\"`\uff08\u672a\u5b8c\u6210\uff09\r\n   - \u901a\u8fc7 `save_message_answer(session_id, message_answer, AgentContentType.AIPPT_CATALOG, \"0\")` \u5199\u5165\u4e00\u6761 assistant \u6d88\u606f\u4f5c\u4e3a\u201c\u7a7a\u7b54\u6848\u5360\u4f4d\u201d\uff0c\u7b49\u5f85\u540e\u7eed\u66f4\u65b0\r\n\r\n6. **\u8c03\u7528\u901a\u4e49 LLM \u63d0\u53d6\u7ed3\u6784\u5316 JSON**\r\n   - \u6784\u9020 `messages = [{'role': 'user', 'content': theme_prompt}]`\r\n   - \u8c03\u7528 `dashscope.Generation.call(model=\"qwen-plus\", ...)`\r\n   - \u4f7f\u7528 `LlmUtil.format_json(..., output_type=OutputType.DICT)` \u5c06 LLM \u8f93\u51fa\u8f6c\u4e3a `contentDict`\uff0c\u5305\u542b\uff1a\r\n     - `title`\r\n     - `text`\r\n     - `theme`\r\n     - `complex`\r\n\r\n7. **\u8c03\u7528\u7b2c\u4e09\u65b9 AIPPT \u751f\u6210\u5927\u7eb2**\r\n   - \u8c03\u7528 `post_aippt(aippt_structure_url, contentDict)`\r\n   - `post_aippt` \u5185\u90e8\uff1a\r\n     - \u4f7f\u7528 `httpx.AsyncClient().post(url, headers=aippt_headers, json=contentDict)`\r\n     - \u6821\u9a8c HTTP \u72b6\u6001\u7801\u4e3a 200\r\n     - \u6821\u9a8c\u4e1a\u52a1 `code == 200`\uff0c\u8fd4\u56de `data` \u5b57\u6bb5\r\n\r\n8. **\u66f4\u65b0\u7b54\u6848\u6d88\u606f\u5e76\u8fd4\u56de**\r\n   - \u82e5\u8c03\u7528\u6210\u529f\uff1a\r\n     - \u5728 `result_data` \u4e2d\u8865\u5145\uff1a\r\n       - `content_type = AIPPT_CATALOG`\r\n       - `handler = HandlerCode.AIPPT`\r\n       - `session_id = session_id`\r\n       - `_id = answer_id`\r\n     - \u8c03\u7528 `update_message_answer(answer_id, content, \"1\")`\uff1a\r\n       - \u5c06\u5360\u4f4d\u6d88\u606f\u7684 `content.ongoing_status` \u6539\u4e3a `\"1\"`\r\n       - \u5e76\u628a\u7b2c\u4e09\u65b9\u8fd4\u56de\u7684 `title/catalogs/...` \u5408\u5e76\u5165 `content`\r\n     - \u63a5\u53e3\u8fd4\u56de `Result.data(result_data)`\r\n   - \u82e5\u7b2c\u4e09\u65b9\u5931\u8d25\uff1a\r\n     - \u5c06 `content.ongoing_status` \u66f4\u65b0\u4e3a `\"2\"`\uff08\u5931\u8d25\uff09\r\n     - \u63a5\u53e3\u8fd4\u56de `Result.false(..., \"\u751f\u6210\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\")` \u6216\u7a7a\u6570\u636e\r\n\r\n\r\n### 4.2 `/aippt/update/catalogs`\uff1a\u66f4\u65b0\u5927\u7eb2\u5185\u5bb9\r\n\r\n1. \u524d\u7aef\u4fee\u6539\u5927\u7eb2\u540e\u643a\u5e26\u6d88\u606f `_id` \u4e0e\u65b0\u7684 `question.title/catalogs` \u8c03\u7528\u8be5\u63a5\u53e3\u3002\r\n2. \u670d\u52a1\u7aef\u8c03\u7528 `update_message_catalogs_id(params)`\uff1a\r\n   - \u901a\u8fc7 `_id` \u67e5\u5230\u5bf9\u5e94\u7684 AIPPT_CATALOG \u6d88\u606f\r\n   - \u66f4\u65b0 `content.title` \u4e0e `content.catalogs`\r\n3. \u8fd4\u56de `handler = HandlerCode.AIPPT`\uff0c\u4e0d\u518d\u8c03\u7528\u5916\u90e8\u670d\u52a1\u3002\r\n\r\n\r\n### 4.3 `/aippt/cover` \u4e0e `/aippt/cover/update`\uff1a\u5c01\u9762\u751f\u6210\u4e0e\u91cd\u65b0\u751f\u6210\r\n\r\n1. **\u83b7\u53d6\u5f53\u524d\u4f1a\u8bdd\u5bf9\u5e94\u7684\u5927\u7eb2\u6d88\u606f**\r\n   - \u901a\u8fc7 `session_id + content_type=AIPPT_CATALOG` \u5728 `ai_agent_message` \u4e2d\u67e5\u5230\u6700\u65b0\u5927\u7eb2\r\n   - \u5c06\u8be5\u5927\u7eb2\u6d88\u606f\u7684 `content.ongoing_status` \u6539\u4e3a `\"3\"`\uff08\u8be5\u6b65\u5df2\u70b9\u8fc7\u6309\u94ae\uff09\r\n\r\n2. **\u51c6\u5907\u5c01\u9762\u751f\u6210\u8bf7\u6c42\u53c2\u6570**\r\n   - \u4ece\u5927\u7eb2\u6d88\u606f\u4e2d\u53d6 `title`\uff0c\u5199\u5165 `questionDict[\"title\"]`\r\n   - \u8865\u5145\u4e1a\u52a1\u5b57\u6bb5\uff1a\r\n     - `count = 4`\uff08\u751f\u6210 4 \u4e2a\u5019\u9009\u5c01\u9762\uff09\r\n     - `size = \"2\"`\r\n     - `user_name = \"AI\u751f\u6210\"`\r\n\r\n3.", "mimetype": "text/plain", "start_char_idx": 3515, "end_char_idx": 5593, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "c240647c-48d3-438d-b051-2f9a1866fd57": {"__data__": {"id_": "c240647c-48d3-438d-b051-2f9a1866fd57", "embedding": null, "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8", "node_type": "4", "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "hash": "421d03d18c36dc09c7dd113680587fd4dc10e90defac8512432282294259e68c", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "6df69ace-7674-49a1-9c41-ea5e69cd3e96", "node_type": "1", "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "hash": "a1e6fd6ebfe9c08109de56030fac053d4d709b2e8650e8da10c04b69c2c02f82", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "af9fa3d5-3b1d-40fe-bc97-d9010e127143", "node_type": "1", "metadata": {}, "hash": "ef35aeae09123a04dc2e9cfc532513f2a6b43c78370c5486026fef43c45cd515", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "**\u83b7\u53d6\u5f53\u524d\u4f1a\u8bdd\u5bf9\u5e94\u7684\u5927\u7eb2\u6d88\u606f**\r\n   - \u901a\u8fc7 `session_id + content_type=AIPPT_CATALOG` \u5728 `ai_agent_message` \u4e2d\u67e5\u5230\u6700\u65b0\u5927\u7eb2\r\n   - \u5c06\u8be5\u5927\u7eb2\u6d88\u606f\u7684 `content.ongoing_status` \u6539\u4e3a `\"3\"`\uff08\u8be5\u6b65\u5df2\u70b9\u8fc7\u6309\u94ae\uff09\r\n\r\n2. **\u51c6\u5907\u5c01\u9762\u751f\u6210\u8bf7\u6c42\u53c2\u6570**\r\n   - \u4ece\u5927\u7eb2\u6d88\u606f\u4e2d\u53d6 `title`\uff0c\u5199\u5165 `questionDict[\"title\"]`\r\n   - \u8865\u5145\u4e1a\u52a1\u5b57\u6bb5\uff1a\r\n     - `count = 4`\uff08\u751f\u6210 4 \u4e2a\u5019\u9009\u5c01\u9762\uff09\r\n     - `size = \"2\"`\r\n     - `user_name = \"AI\u751f\u6210\"`\r\n\r\n3. **\u7b54\u6848\u6d88\u606f\u5165\u5e93**\r\n   - `/cover`\uff1a\u901a\u8fc7 `save_message_answer_cover(params)` \u65b0\u5efa\u4e00\u6761 `AIPPT_COVER` \u6d88\u606f\uff0c`content.ongoing_status = \"0\"`\u3002\r\n   - `/cover/update`\uff1a\u901a\u8fc7 `update_message_answer_cover(_id, params, \"0\")` \u66f4\u65b0\u5df2\u6709\u5c01\u9762\u6d88\u606f\uff08\u989c\u8272\u3001\u98ce\u683c\u7b49\uff09\uff0c\u5e76\u91cd\u7f6e\u8fdb\u884c\u4e2d\u72b6\u6001\u3002\r\n\r\n4. **\u8c03\u7528\u7b2c\u4e09\u65b9 AIPPT \u5c01\u9762\u63a5\u53e3**\r\n   - `post_aippt(aippt_cover_url, questionDict)`\r\n   - \u82e5\u6210\u529f\uff0c\u7ec4\u88c5\u8fd4\u56de\uff1a\r\n     - `_id`\uff1a\u5c01\u9762\u6d88\u606f id\r\n     - `content_type = AIPPT_COVER`\r\n     - `handler = HandlerCode.AIPPT`\r\n     - `cover_image_list`\uff1a\u62bd\u53d6 `cover_image / cover_id / color` \u5217\u8868\r\n   - \u66f4\u65b0 Mongo \u4e2d\u5bf9\u5e94\u5c01\u9762\u6d88\u606f\uff1a\r\n     - `content.ongoing_status = \"1\"`\r\n     - \u5199\u5165 `cover_image_list` \u7b49\u5b8c\u6574\u5185\u5bb9\r\n\r\n\r\n### 4.4 `/aippt/create`\uff1a\u751f\u6210 PPT\r\n\r\n1. \u5c06\u5c01\u9762\u6d88\u606f `content.ongoing_status` \u66f4\u65b0\u4e3a `\"3\"`\uff08\u5df2\u70b9\u51fb\u751f\u6210\uff09\r\n2. \u901a\u8fc7 `session_id + AIPPT_CATALOG` \u67e5\u51fa\u5f53\u524d\u4f1a\u8bdd\u7684\u5927\u7eb2\u5185\u5bb9\r\n3. \u7ec4\u88c5 `custom_data`\uff1a\r\n   - `title`\uff1a\u5927\u7eb2\u6807\u9898\r\n   - `catalogs`\uff1a\u5927\u7eb2\u76ee\u5f55\r\n4. \u5c06 `custom_data` \u6302\u5230 `question.custom_data` \u540e\uff0c\u8c03\u7528 `post_aippt(aippt_create_url, questionDict)`\r\n5. \u82e5\u6210\u529f\uff1a\r\n   - \u5728\u7ed3\u679c\u4e2d\u8865\u5145 `handler = HandlerCode.AIPPT`\r\n   - \u8c03\u7528 `save_message_answer_result(params, AIPPT_RESULT, ppt_id)` \u5b58\u4e00\u6761 `AIPPT_RESULT` \u6d88\u606f\uff1a\r\n     - `content.id = ppt_id`\r\n     - `content.status = 1`\r\n     - `content.ongoing_status = \"0\"`\r\n6. \u8fd4\u56de\u7b2c\u4e09\u65b9\u539f\u59cb\u7ed3\u679c\uff08\u542b PPT id \u7b49\uff09\u3002\r\n\r\n\r\n### 4.5 `/aippt/result`\uff1a\u67e5\u8be2 PPT \u751f\u6210\u8fdb\u5ea6\r\n\r\n1. \u4ece `params.question.ppt_id` \u6784\u9020\u67e5\u8be2\u53c2\u6570\r\n2. \u8c03\u7528 `get_aippt(aippt_result_url, query)` \u5411\u7b2c\u4e09\u65b9\u67e5\u8be2\u72b6\u6001\r\n3. \u82e5\u6210\u529f\uff1a\r\n   - \u6784\u9020 `result`\uff1a\r\n     - `content_type = AIPPT_RESULT`\r\n     - `handler = HandlerCode.AIPPT`\r\n     - `id`\uff1aPPT id\r\n     - `status`\uff1a\u751f\u6210\u72b6\u6001\r\n     - \u82e5\u5b58\u5728 `images_url` \u5217\u8868\uff0c\u5219\u53d6 `time` \u6700\u5c0f\u7684\u4e00\u4e2a\u4f5c\u4e3a\u7f29\u7565\u56fe URL\r\n   - \u8c03\u7528 `update_message_answer_result(params, result, \"0\")`\uff0c\u6839\u636e status \u66f4\u65b0\u672c\u5730\u6d88\u606f\uff1a\r\n     - `status == 2`\uff1a\u751f\u6210\u5b8c\u6210\uff0c`ongoing_status = \"1\"`\uff0c\u5199\u5165 `images_url`\r\n     - `status == 3`\uff1a\u751f\u6210\u5931\u8d25\uff0c`ongoing_status = \"2\"`\r\n4.", "mimetype": "text/plain", "start_char_idx": 5267, "end_char_idx": 7264, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "af9fa3d5-3b1d-40fe-bc97-d9010e127143": {"__data__": {"id_": "af9fa3d5-3b1d-40fe-bc97-d9010e127143", "embedding": null, "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8", "node_type": "4", "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "hash": "421d03d18c36dc09c7dd113680587fd4dc10e90defac8512432282294259e68c", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "c240647c-48d3-438d-b051-2f9a1866fd57", "node_type": "1", "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "hash": "7633eca01e5366a5cfa0b969be3d6b82fc08cbc6420b04bde440c153e9908d76", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "cdcba056-4926-4f36-8bdb-7385cb1f1986", "node_type": "1", "metadata": {}, "hash": "c773fb6dc4ab3cf447b1485e000bbf0aae9a95a3e45cbd1f9a13c7fb2a92fb1e", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\u8c03\u7528 `get_aippt(aippt_result_url, query)` \u5411\u7b2c\u4e09\u65b9\u67e5\u8be2\u72b6\u6001\r\n3. \u82e5\u6210\u529f\uff1a\r\n   - \u6784\u9020 `result`\uff1a\r\n     - `content_type = AIPPT_RESULT`\r\n     - `handler = HandlerCode.AIPPT`\r\n     - `id`\uff1aPPT id\r\n     - `status`\uff1a\u751f\u6210\u72b6\u6001\r\n     - \u82e5\u5b58\u5728 `images_url` \u5217\u8868\uff0c\u5219\u53d6 `time` \u6700\u5c0f\u7684\u4e00\u4e2a\u4f5c\u4e3a\u7f29\u7565\u56fe URL\r\n   - \u8c03\u7528 `update_message_answer_result(params, result, \"0\")`\uff0c\u6839\u636e status \u66f4\u65b0\u672c\u5730\u6d88\u606f\uff1a\r\n     - `status == 2`\uff1a\u751f\u6210\u5b8c\u6210\uff0c`ongoing_status = \"1\"`\uff0c\u5199\u5165 `images_url`\r\n     - `status == 3`\uff1a\u751f\u6210\u5931\u8d25\uff0c`ongoing_status = \"2\"`\r\n4. \u8fd4\u56de\u5f53\u524d\u72b6\u6001\u7ed9\u524d\u7aef\u3002\r\n\r\n\r\n### 4.6 `/aippt/download` \u4e0e `/aippt/editor`\uff1a\u4e0b\u8f7d\u4e0e\u5728\u7ebf\u7f16\u8f91\r\n\r\n- `/download`\uff1a\r\n  - \u8c03\u7528 `get_aippt(aippt_download_url, {\"id\": ppt_id})`\r\n  - \u8fd4\u56de\u7b2c\u4e09\u65b9\u7ed9\u51fa\u7684\u4e0b\u8f7d URL \u7b49\u4fe1\u606f\uff0c\u5e76\u8865\u5145 `handler = HandlerCode.AIPPT`\r\n\r\n- `/editor`\uff1a\r\n  - \u8c03\u7528 `post_aippt(aippt_editor_url, {\"id\": ppt_id, \"expire\": \"86400\"})`\r\n  - \u8fd4\u56de\u53ef\u5728\u7ebf\u7f16\u8f91\u7684\u94fe\u63a5\u4e0e\u8fc7\u671f\u65f6\u95f4\uff0c\u540c\u6837\u8865\u5145 `handler = HandlerCode.AIPPT`\r\n\r\n\u8fd9\u4e9b\u63a5\u53e3\u4e0d\u518d\u4fee\u6539 Mongo \u6d88\u606f\uff0c\u53ea\u63d0\u4f9b\u8f85\u52a9\u80fd\u529b\u3002\r\n\r\n---\r\n\r\n## 5. \u5b58\u50a8\u7ed3\u6784\u4e0e\u67e5\u8be2\u8981\u70b9\r\n\r\n### 5.1 \u4f1a\u8bdd\u5b58\u50a8\uff1a`SessionService`\r\n\r\n- \u96c6\u5408\uff1a`ai_agent_session`\r\n- \u5173\u952e\u5b57\u6bb5\uff1a\r\n  - `_id`\uff1a`session_id`\r\n  - `tenant_id` / `user_id` / `agent_id`\r\n  - `title`\uff1a\u4e00\u822c\u53d6\u9996\u6b21\u95ee\u9898\u5185\u5bb9\r\n  - `handler_json`\uff1a\u8bb0\u5f55\u4f7f\u7528\u8fc7\u7684 handler \u5217\u8868\uff08\u5982 `\"aippt\"`\uff09\r\n  - `skill_id`\r\n  - `create_time` / `update_time`\r\n  - `deleted`\uff1a\u903b\u8f91\u5220\u9664\u6807\u8bb0\r\n\r\n\r\n### 5.2 \u6d88\u606f\u5b58\u50a8\uff1a`MessageService.aippt_save_messages`\r\n\r\n- \u96c6\u5408\uff1a`ai_agent_message`\r\n- \u516c\u5171\u5b57\u6bb5\uff1a\r\n  - `_id`\uff1a\u6d88\u606f\u4e3b\u952e\r\n  - `role`\uff1a`user` / `assistant`\r\n  - `agent_id` / `session_id` / `user_id` / `tenant_id`\r\n  - `skill_id` / `plugin_json`\r\n  - `handler`\uff1a\u5982 `\"aippt\"`\r\n  - `section_id`\uff1a\u4f1a\u8bdd\u5185\u7684\u5206\u6bb5\u7f16\u53f7\r\n  - `create_time` / `update_time`\r\n  - `deleted`\r\n\r\n- user \u6d88\u606f\uff1a\r\n  - `content`\uff1a`question` JSON \u5e8f\u5217\u5316\u540e\u7684\u5b57\u7b26\u4e32\r\n  - `content_type`\uff1a\u4f8b\u5982 `AIPPT_THEME`\r\n  - `message_type = \"question\"`\r\n  - `reply_id = \"0\"`\r\n\r\n- assistant \u6d88\u606f\uff1a\r\n  - `content`\uff1a\u5404\u9636\u6bb5\u7ed3\u679c JSON \u5e8f\u5217\u5316\u540e\u7684\u5b57\u7b26\u4e32\r\n  - `content_type`\uff1a`AIPPT_CATALOG` / `AIPPT_COVER` / `AIPPT_RESULT`\r\n  - `message_type = \"answer\"`\r\n  - `reply_id`\uff1a\u5173\u8054\u7684\u95ee\u9898\u6216\u4e0a\u4e00\u9636\u6bb5\u7684 `_id`\r\n\r\nAIPPT \u76f8\u5173\u7684\u72b6\u6001\u4f4d\u7edf\u4e00\u7528 `content.ongoing_status` \u7ba1\u7406\uff1a\r\n\r\n- `\"0\"`\uff1a\u521a\u521b\u5efa / \u7b49\u5f85\u5916\u90e8\u63a5\u53e3\u8fd4\u56de\r\n- `\"1\"`\uff1a\u6210\u529f\u5b8c\u6210\r\n- `\"2\"`\uff1a\u5931\u8d25\r\n- `\"3\"`\uff1a\u5df2\u88ab\u540e\u7eed\u64cd\u4f5c\u8986\u76d6 / \u5df2\u4fee\u6539\r\n\r\n---\r\n\r\n## 6.", "mimetype": "text/plain", "start_char_idx": 6818, "end_char_idx": 8755, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "cdcba056-4926-4f36-8bdb-7385cb1f1986": {"__data__": {"id_": "cdcba056-4926-4f36-8bdb-7385cb1f1986", "embedding": null, "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8", "node_type": "4", "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "hash": "421d03d18c36dc09c7dd113680587fd4dc10e90defac8512432282294259e68c", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "af9fa3d5-3b1d-40fe-bc97-d9010e127143", "node_type": "1", "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "hash": "161a056ebb20aa145ba69d8cd617e9c406bd4687f1a8bf2fd4a984f7f244e8b8", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "942f6446-5230-4275-81c0-6ffbda882463", "node_type": "1", "metadata": {}, "hash": "4857db08adda7882acec07c528481b05ce9b8bb8e9ddc8b21c48c36ebb43010c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "AIPPT \u5168\u94fe\u8def ASCII \u6d41\u7a0b\u56fe\r\n\r\n\u4e0b\u56fe\u4ece `/aippt/chat` \u5f00\u59cb\uff0c\u4e32\u8054\u5927\u7eb2\u3001\u5c01\u9762\u3001\u751f\u6210\u4e0e\u4e0b\u8f7d\u7684\u6574\u4f53\u6d41\u7a0b\uff1a\r\n\r\n```text\r\n          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n          \u2502          \u524d\u7aef\u5ba2\u6237\u7aef         \u2502\r\n          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                       \u2502 1. /aippt/chat\r\n                       v\r\n             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n             \u2502   FastAPI /aippt      \u2502\r\n             \u2502   (aippt_api.py)      \u2502\r\n             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                       \u2502 \u89e3\u6790 AipptParams\r\n                       \u2502 get_validated_aippt_params\r\n                       v\r\n             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n             \u2502   AgentService        \u2502\r\n             \u2502 get_agent_by_id       \u2502\r\n             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                       \u2502 \u6821\u9a8c\u667a\u80fd\u4f53 / \u6ce8\u5165 tenant_id\r\n                       v\r\n             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n             \u2502   AipptService        \u2502\r\n             \u2502  get_aippt_chat       \u2502\r\n             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                       \u2502\r\n                       \u2502 update_ongoing_status_by_session_id\r\n                       v\r\n             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n             \u2502  SessionService       \u2502\r\n             \u2502 upsert_agent_session  \u2502\r\n             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                       \u2502 \u5199\u5165/\u66f4\u65b0 ai_agent_session\r\n                       v\r\n             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n             \u2502 MessageService        \u2502\r\n             \u2502 aippt_save_messages   \u2502 (user \u95ee\u9898)\r\n             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                       \u2502 \u751f\u6210\u5360\u4f4d\u7b54\u6848 (AIPPT_CATALOG)\r\n                       v\r\n             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n             \u2502  \u901a\u4e49 LLM (dashscope) \u2502\r\n             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                       \u2502 \u751f\u6210\u7ed3\u6784\u5316 JSON (title/theme/...)\r\n                       v\r\n             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n             \u2502  \u7b2c\u4e09\u65b9 AIPPT \u5e73\u53f0    \u2502\r\n             \u2502  structure_url         \u2502\r\n             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                       \u2502 \u8fd4\u56de\u5927\u7eb2\u6570\u636e\r\n                       v\r\n             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n             \u2502 update_message_answer \u2502\r\n             \u2502  (\u5199\u5165\u5927\u7eb2+\u72b6\u6001=1)     \u2502\r\n             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                       \u2502\r\n                       v\r\n          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n          \u2502        Result.data           \u2502\r\n          \u2502   (\u8fd4\u56de\u5927\u7eb2\u7ed9\u524d\u7aef)           \u2502\r\n          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\r\n\r\n  [\u5c01\u9762\u751f\u6210 /cover]\r\n\r\n \u524d\u7aef\u9009\u62e9\u5927\u7eb2\u540e\u70b9\u51fb\u5c01\u9762\u751f\u6210:\r\n\r\n          \u524d\u7aef \u2500\u2500 /aippt/cover \u2500\u2500\u25b6 FastAPI \u2500\u2500\u25b6 AipptService.get_aippt_cover\r\n                                         \u2502\r\n                                         \u2502 \u6839\u636e session_id \u67e5\u8be2 AIPPT_CATALOG\r\n                                         \u2502 update_message_answer(ongoing=3)\r\n                                         \u2502 save_message_answer_cover (AIPPT_COVER, ongoing=0)\r\n                                         v\r\n                               \u7b2c\u4e09\u65b9 AIPPT cover_url\r\n                                         \u2502 \u8fd4\u56de\u5c01\u9762\u5217\u8868\r\n                                         v\r\n                               update_message_answer(ongoing=1, \u5199\u5165\u5c01\u9762\u5217\u8868)\r\n                                         \u2502\r\n                                         v\r\n                                      Result.data\r\n\r\n\r\n  [\u751f\u6210 PPT /create]\r\n\r\n \u524d\u7aef\u9009\u62e9\u5c01\u9762\u540e\u70b9\u51fb\u751f\u6210 PPT:\r\n\r\n          \u524d\u7aef \u2500\u2500 /aippt/create \u2500\u2500\u25b6 FastAPI \u2500\u2500\u25b6 AipptService.get_aippt_create\r\n                                         \u2502\r\n                                         \u2502 update_message_cover_id(ongoing=3, \u8bb0\u5f55 cover_id)\r\n                                         \u2502 \u67e5\u8be2 AIPPT_CATALOG \u83b7\u53d6 title+catalogs\r\n                                         \u2502 question.custom_data = { title, catalogs }\r\n                                         v\r\n                               \u7b2c\u4e09\u65b9 AIPPT create_url\r\n                                         \u2502 \u8fd4\u56de PPT id\r\n                                         v\r\n                               save_message_answer_result\r\n                               (AIPPT_RESULT, content.id=status=1, ongoing=0)\r\n                                         \u2502\r\n                                         v\r\n                                      Result.", "mimetype": "text/plain", "start_char_idx": 8756, "end_char_idx": 12783, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "942f6446-5230-4275-81c0-6ffbda882463": {"__data__": {"id_": "942f6446-5230-4275-81c0-6ffbda882463", "embedding": null, "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b33f77a4-f79f-4b39-8e3f-3d64028772b8", "node_type": "4", "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "hash": "421d03d18c36dc09c7dd113680587fd4dc10e90defac8512432282294259e68c", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "cdcba056-4926-4f36-8bdb-7385cb1f1986", "node_type": "1", "metadata": {"source": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md", "mongo_id": "696c2dea1e6a42434eae42cb", "filename": "AIPPT\u6a21\u5757\u6267\u884c\u903b\u8f91\u4e0e\u6d41\u7a0b\u56fe.md"}, "hash": "60e6786e3103f063aee827c832c30385dbfb51eff98c2a57e17ee2e46ac7cbc9", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\u5199\u5165\u5c01\u9762\u5217\u8868)\r\n                                         \u2502\r\n                                         v\r\n                                      Result.data\r\n\r\n\r\n  [\u751f\u6210 PPT /create]\r\n\r\n \u524d\u7aef\u9009\u62e9\u5c01\u9762\u540e\u70b9\u51fb\u751f\u6210 PPT:\r\n\r\n          \u524d\u7aef \u2500\u2500 /aippt/create \u2500\u2500\u25b6 FastAPI \u2500\u2500\u25b6 AipptService.get_aippt_create\r\n                                         \u2502\r\n                                         \u2502 update_message_cover_id(ongoing=3, \u8bb0\u5f55 cover_id)\r\n                                         \u2502 \u67e5\u8be2 AIPPT_CATALOG \u83b7\u53d6 title+catalogs\r\n                                         \u2502 question.custom_data = { title, catalogs }\r\n                                         v\r\n                               \u7b2c\u4e09\u65b9 AIPPT create_url\r\n                                         \u2502 \u8fd4\u56de PPT id\r\n                                         v\r\n                               save_message_answer_result\r\n                               (AIPPT_RESULT, content.id=status=1, ongoing=0)\r\n                                         \u2502\r\n                                         v\r\n                                      Result.data\r\n\r\n\r\n  [\u67e5\u8be2\u7ed3\u679c /result]\r\n\r\n          \u524d\u7aef \u2500\u2500 /aippt/result (ppt_id) \u2500\u2500\u25b6 AipptService.get_aippt_result\r\n                                         \u2502\r\n                                         v\r\n                               \u7b2c\u4e09\u65b9 AIPPT result_url\r\n                                         \u2502 \u8fd4\u56de status / images_url[]\r\n                                         v\r\n                               update_message_answer_result\r\n                               (\u6839\u636e status \u66f4\u65b0 ongoing_status\r\n                                \u5e76\u5728\u5b8c\u6210\u65f6\u5199\u5165\u7f29\u7565\u56fe URL)\r\n                                         \u2502\r\n                                         v\r\n                                      Result.data (\u72b6\u6001+\u7f29\u7565\u56fe)\r\n\r\n\r\n  [\u4e0b\u8f7d\u4e0e\u7f16\u8f91]\r\n\r\n          \u524d\u7aef \u2500\u2500 /aippt/download \u2500\u25b6 get_aippt(download_url)\r\n          \u524d\u7aef \u2500\u2500 /aippt/editor  \u2500\u25b6 post_aippt(editor_url, id+expire)\r\n\r\n          \u2514\u2500 \u5747\u76f4\u63a5\u8fd4\u56de\u7b2c\u4e09\u65b9\u7ed9\u51fa\u7684\u94fe\u63a5 + handler=AIPPT\uff0c\u4e0d\u518d\u5199\u5165\u6d88\u606f\r\n```\r\n\r\n---\r\n\r\n## 7. \u5c0f\u7ed3\r\n\r\n- AIPPT \u6a21\u5757\u901a\u8fc7 `/aippt` \u8def\u7531\u5bf9\u5916\u63d0\u4f9b\u591a\u9636\u6bb5\u80fd\u529b\uff1a\u4e3b\u9898 \u2192 \u5927\u7eb2 \u2192 \u5c01\u9762 \u2192 PPT \u751f\u6210 \u2192 \u7ed3\u679c\u67e5\u8be2 \u2192 \u4e0b\u8f7d/\u7f16\u8f91\u3002\r\n- \u6bcf\u4e2a\u9636\u6bb5\u90fd\u4f1a\uff1a\r\n  - \u7ed1\u5b9a\u5230 `session_id`\uff0c\u901a\u8fc7 `SessionService` \u7ba1\u7406\u4f1a\u8bdd\u8bb0\u5f55\uff1b\r\n  - \u4f7f\u7528 `MessageService.aippt_save_messages` \u5728 `ai_agent_message` \u4e2d\u8bb0\u5f55\u95ee\u9898\u4e0e\u7b54\u6848\uff1b\r\n  - \u901a\u8fc7 `content_type` + `ongoing_status` \u7cbe\u7ec6\u8868\u793a\u4e1a\u52a1\u72b6\u6001\u3002\r\n- \u5916\u90e8\u8c03\u7528\u5206\u4e3a\u4e24\u7c7b\uff1a\r\n  - \u901a\u4e49 LLM\uff08\u7ed3\u6784\u5316\u4e3b\u9898 JSON \u63d0\u53d6\uff09\u3002\r\n  - \u7b2c\u4e09\u65b9 AIPPT \u5e73\u53f0\uff08\u5927\u7eb2/\u5c01\u9762/PPT/\u7ed3\u679c/\u4e0b\u8f7d/\u7f16\u8f91\uff09\u3002\r\n\r\n\u672c\u624b\u518c\u7528\u4e8e\u5e2e\u52a9\u7406\u89e3 AIPPT \u6574\u4f53\u6267\u884c\u94fe\u8def\u4e0e MongoDB \u5b58\u50a8\u7ed3\u6784\uff0c\u4fbf\u4e8e\u540e\u7eed\u6392\u67e5\u7ebf\u4e0a\u95ee\u9898\u6216\u6269\u5c55\u65b0\u80fd\u529b\u3002", "mimetype": "text/plain", "start_char_idx": 11743, "end_char_idx": 14083, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}}}